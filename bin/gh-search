#!/bin/sh

#
# gh-search: Search for filetypes on GitHub
#

usage='Usage: gh-search [-e|--extension] [-f|--filename] [-l|--language] query'
type=extension

[ $# -lt 2 ] && {
	>&2 printf '%s\n' "$usage"
	exit 1
}

while [ -n "$1" ]; do case $1 in
	-e|--ext|--extension) type=extension ;;
	-f|--file|--filename) type=filename  ;;
	-n|--name)            type=filename  ;;
	-l|--language)        type=language  ;;
	--)                   shift; break   ;;
	-*)
		printf '%s\n' "$usage"
		case $1 in
			-h|--help|-\?) exit 0 ;;
			*)             exit 1 ;;
		esac ;;
	*) break ;;
esac; shift
done

[ -z "$1" ] && {
	>&2 printf 'gh-search: No search query specified\n'
	>&2 printf '%s\n' "$usage"
	exit 1
}

# Resolve prefix based on search type
case $type in
	extension) query="path:**/?*.${1#.}" ;;
	filename)  query="path:**/$1" ;;
	language)  query="language:\"$1\"" ;;
esac

# Append any additional query parameters
shift
while [ $# -gt 0 ]; do
	case $1 in
		*\ *) query="$query \"$1\"" ;;
		*?*)  query="$query $1" ;;
	esac
	shift
done

case `uname -s` in
	Darwin) browse=open ;;
	*)      browse=xdg-open ;;
esac

$browse "https://github.com/search?q=`printf %s "$query" | sed '
	s/:/%3A/g
	s,/,%2F,g
	s/[[:blank:]]\{1,\}/+/g
'`&type=Code"
