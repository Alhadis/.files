#!/bin/sh

have(){
	command -v "$1" 2>&1 >/dev/null
}

physpath(){
	have realpath && realpath "$1 --" || printf '%s\n' "$1"
}

open(){
	if have atom
	then atom -d "$@"
	else emacs -nw "$@"
	fi
}

while [ "$1" ]; do case $1 in

	# Print a short help notice
	-h|--help|-\?)
		>&2 printf 'Usage: @ [-m name] [-x name] ...files\n'
		exit 0 ;;

	# Open a manpage by name
	-m|--man)
		shift
		path=`man -w $@` || exit 1
		open `physpath "$path" | head -n1`
		exit $? ;;

	# Open an executable by name
	-x|--exec)
		path=`command -v 2>/dev/null "$2"`
		grep -Iq "$path" -Ee. || echo "Binary file" && exit 1
		open `physpath "$path"`
		exit $? ;;

	# Anything else; pass to program
	*) break ;;

esac; shift
done

[ $# -eq 0 ] && set -- "."

open "$@"
